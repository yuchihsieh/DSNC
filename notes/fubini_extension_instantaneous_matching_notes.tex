\documentclass[11pt]{article}

% Standalone note (NOT part of the main paper).
\usepackage{amsmath,amssymb,amsthm}
\usepackage{mathtools}
\usepackage[hidelinks]{hyperref}
\usepackage{cleveref}
\usepackage{geometry}
\geometry{margin=1.7in}

% Theorem environments
\theoremstyle{definition}
\newtheorem{definition}{Definition}[section]
\newtheorem{remark}{Remark}[section]
\theoremstyle{plain}
\newtheorem{theorem}{Theorem}[section]

\title{Notes: Fubini extensions for static random matching (Duffie--Sun 2007)\\(Loeb-space construction)}
\author{Yu-Chi Hsieh}
\date{\today}

\begin{document}
\maketitle
\tableofcontents

\newpage
\section{Fubini extensions for static random matching (Loeb-space construction)}
\label{sec:fubini-extension-instantaneous-matching}

\subsection{Quick map to the source papers (Sun 2006; Duffie--Sun 2007)}
\label{subsec:quick-map}
\noindent
This note is distilled primarily from:
\begin{itemize}
  \item Y.\ Sun (2006), \emph{The exact law of large numbers via Fubini extension and characterization of insurable risks} (JET 126), and
  \item D.\ Duffie and Y.\ Sun (2007), \emph{Existence of independent random matching} (AAP 17).
\end{itemize}
\noindent
To make it easy to find the original statements, we record the main correspondences:
\begin{itemize}
  \item \textbf{Fubini extension definition}: this note's \cref{subsec:fubini-extension-def} is \textbf{Sun (2006), Definition 2.2} (and also \textbf{Duffie--Sun (2007), Definition 2.1}).
  \item \textbf{Incompatibility (usual product measurability + independence)}: mentioned in \S\cref{sec:fubini-extension-instantaneous-matching}\,\S\cref{subsec:fubini-extension-def} is \textbf{Sun (2006), Proposition 2.1}.
  \item \textbf{Random full matching \& independence-in-types}: the static matching model in \S\cref{subsec:instantaneous-matching} follows \textbf{Duffie--Sun (2007), Definitions 2.2--2.3} and \textbf{Theorem 2.4}.
  \item \textbf{Random partial matching}: the static search/partial-matching result summarized in \S\cref{subsec:partial-matching} follows \textbf{Duffie--Sun (2007), Definition 2.5} and \textbf{Theorem 2.6}.
  \item \textbf{(Optional) exact LLN on a Fubini extension}: the aggregation principle in \S\cref{subsec:elln} is from \textbf{Sun (2006)} (and is used throughout the matching literature once essential pairwise independence is available).
\end{itemize}

\subsection{Aim and scope}
Many economic and probabilistic models posit a \emph{continuum} of agents, indexed by an atomless probability space $(I,\mathcal I,\lambda)$, together with \emph{static random matching} at a given time (a single random matching draw), typically represented as a random involution $\varphi:I\times\Omega\to I$ satisfying $\varphi(\varphi(i,\omega),\omega)=i$.

The foundational difficulty is that, for nontrivial processes $(f_i)_{i\in I}$, \emph{independence} of the family and \emph{joint measurability} of the mapping $(i,\omega)\mapsto f_i(\omega)$ with respect to the usual product $\sigma$-algebra $\mathcal I\otimes\mathcal F$ are, in general, incompatible except in degenerate cases. This obstruction goes back at least to Doob and is made precise in the modern literature via results such as: if $f:I\times\Omega\to X$ is $\mathcal I\otimes\mathcal F$-measurable and essentially pairwise independent, then almost all coordinates $f_i$ are essentially constant (\textbf{Sun (2006), Proposition 2.1}).

\medskip
\noindent
The goal of this note is to give a \emph{minimalist, self-contained, rigorous} construction of a probability space large enough to support:
\begin{itemize}
  \item a continuum of (essentially) independent random objects with the \emph{Fubini property}, and
  \item a \emph{static} (one-shot) random matching map with the \emph{independence-in-types} properties used in economics and genetics.
\end{itemize}
The construction is based on \emph{nonstandard analysis} and \emph{Loeb measures}, following the approach underlying Sun (2006) and Duffie--Sun (2007).

\subsection{Measure-theoretic target: Fubini extensions}
\label{subsec:fubini-extension-def}

\begin{definition}[Fubini extension]
Let $(I,\mathcal I,\lambda)$ and $(\Omega,\mathcal F,P)$ be probability spaces. A probability space
\[
(I\times\Omega,\ \mathcal W,\ Q)
\]
is a \emph{Fubini extension} of the usual product $(I\times\Omega,\mathcal I\otimes\mathcal F,\lambda\otimes P)$ if:
\begin{enumerate}
  \item $\mathcal I\otimes\mathcal F\subseteq \mathcal W$ and $Q$ extends $\lambda\otimes P$; and
  \item for every $Q$-integrable $g:I\times\Omega\to\mathbb R$, the sections $g_i(\omega)\coloneqq g(i,\omega)$ and $g_\omega(i)\coloneqq g(i,\omega)$ are integrable for $\lambda$-a.e.\ $i$ and $P$-a.e.\ $\omega$, and
  \[
  \int g\,dQ
  =\int_I\Big(\int_\Omega g_i\,dP\Big)\,d\lambda
  =\int_\Omega\Big(\int_I g_\omega\,d\lambda\Big)\,dP.
  \]
\end{enumerate}
This is exactly \textbf{Sun (2006), Definition 2.2}. The same definition is also used in \textbf{Duffie--Sun (2007), Definition 2.1}.
Following Sun (2006), we often denote such a space by $(I\times\Omega,\ \mathcal I\boxtimes\mathcal F,\ \lambda\boxtimes P)$ to emphasize the retention of Fubini's theorem beyond $\mathcal I\otimes\mathcal F$.
\end{definition}

\begin{remark}[Why we need an extension]
If we insist on $\mathcal W=\overline{\mathcal I\otimes\mathcal F}$ (the completion of the usual product) then, for many independence hypotheses that economists want (e.g.\ i.i.d.\ types, independent match outcomes), one cannot have a jointly measurable process unless it is essentially constant. A Fubini extension enlarges the measurable sets on $I\times\Omega$ so that one can have \emph{joint measurability} of useful processes while retaining the ability to interchange integrals.
\end{remark}

\subsection{(Optional) Exact law of large numbers (ELLN) on a Fubini extension}
\label{subsec:elln}
This note's focus is \emph{existence} of a Fubini extension supporting static random matching.
Once one has an essentially pairwise independent process on a Fubini extension, Sun (2006) provides an \emph{exact} law of large numbers: sample cross-sections aggregate deterministically almost surely.

\begin{remark}[What ELLN buys in static matching, informally]
Let $f:I\times\Omega\to X$ be $\mathcal I\boxtimes\mathcal F$-measurable with values in a Polish space $X$ and assume $(f_i)_{i\in I}$ is essentially pairwise independent.
Then for $P$-a.e.\ $\omega$, the sample function $i\mapsto f(i,\omega)$ has the \emph{same distribution} (under $\lambda$) as the random variable $f$ (under $\lambda\boxtimes P$).
Applied to matching, this means: once the partner-type process is essentially pairwise independent, the realized cross-sectional frequencies of partner types equal their expectations \emph{exactly}, a.s.
\end{remark}

\subsection{A minimalist introduction to nonstandard analysis}
\label{subsec:nsa-minimal}
We give a concrete ``toolkit'' sufficient for Loeb measures and hyperfinite constructions.

\subsubsection{Ultrafilters and ultrapowers (one standard construction)}
\begin{definition}[Filter on a set]
Let $S$ be a nonempty set. A \emph{filter} $\mathcal F$ on $S$ is a nonempty collection of subsets of $S$ such that:
\begin{enumerate}
  \item $\emptyset\notin\mathcal F$;
  \item if $A\in\mathcal F$ and $A\subseteq B\subseteq S$, then $B\in\mathcal F$ (upward closed);
  \item if $A,B\in\mathcal F$, then $A\cap B\in\mathcal F$ (closed under finite intersections).
\end{enumerate}
\end{definition}

\begin{remark}[Existence of free ultrafilters (via Zorn/AC)]
There is no explicit ``formula'' example of a free ultrafilter on $\mathbb N$.
Its existence is usually proved using the \emph{Ultrafilter Lemma} (every proper filter extends to an ultrafilter), which follows from Zorn's lemma and hence from the Axiom of Choice.
Concretely, start from the \emph{Fr\'echet filter} of cofinite sets
$\mathcal F_{\mathrm{cof}}=\{A\subseteq\mathbb N:\mathbb N\setminus A\text{ is finite}\}$,
extend it to an ultrafilter $\mathcal U\supseteq\mathcal F_{\mathrm{cof}}$, and then $\mathcal U$ must be \emph{free} (non-principal) because it contains no finite sets.
For the purposes of this note, the key point is simply: we may \emph{fix} one free ultrafilter $\mathcal U$ and treat its elements as ``$\mathcal U$-large'' subsets of $\mathbb N$.
\end{remark}

Let $\mathbb N$ be the natural numbers. A (free) \emph{ultrafilter} $\mathcal U$ on $\mathbb N$ is a collection of subsets of $\mathbb N$ satisfying:
\begin{enumerate}
  \item $\emptyset\notin\mathcal U$, and if $A\in\mathcal U$ and $A\subseteq B$, then $B\in\mathcal U$;
  \item if $A,B\in\mathcal U$, then $A\cap B\in\mathcal U$;
  \item for every $A\subseteq\mathbb N$, exactly one of $A$ and $\mathbb N\setminus A$ lies in $\mathcal U$;
  \item $\mathcal U$ is \emph{free}: no finite subset of $\mathbb N$ is in $\mathcal U$.
\end{enumerate}
Fix such a (free) ultrafilter $\mathcal U$. Intuitively, members of $\mathcal U$ are the subsets of $\mathbb N$ that we declare to be \emph{$\mathcal U$-large} (a strengthened notion of ``for almost all $n$'').

The \emph{ultrapower} ${}^\ast\mathbb R$ is defined as the quotient $\mathbb R^{\mathbb N}/\sim$, where for two real sequences $(x_n)$ and $(y_n)$ we declare
\[
(x_n)\sim(y_n)\quad\Longleftrightarrow\quad \{n\in\mathbb N: x_n=y_n\}\in\mathcal U.
\]
Note that this definition uses \emph{one specific subset} of $\mathbb N$, namely the equality set $\{n:x_n=y_n\}$; it does \emph{not} require any condition to hold for all sets in $\mathcal U$.

We write ${}^\ast x$ for the equivalence class of the constant sequence $(x,x,\dots)$. This gives an embedding $\mathbb R\hookrightarrow {}^\ast\mathbb R$.
Moreover, we can add and multiply equivalence classes by doing so coordinatewise on representative sequences, making ${}^\ast\mathbb R$ into a field containing $\mathbb R$ as a subfield (hence the phrase ``identifying $\mathbb R$ with a subfield of ${}^\ast\mathbb R$'').

\subsubsection{Infinitesimals and unlimited hyperintegers}
A hyperreal $\varepsilon\in{}^\ast\mathbb R$ is \emph{infinitesimal} if $|\varepsilon|<1/n$ for all $n\in\mathbb N$. A hyperinteger $N\in{}^\ast\mathbb N$ is \emph{unlimited} if $N>n$ for all $n\in\mathbb N$. Existence of unlimited hyperintegers follows from the freeness of $\mathcal U$.

\subsubsection{Standard part}
Every finite hyperreal $x\in{}^\ast\mathbb R$ (i.e.\ $|x|<n$ for some $n\in\mathbb N$) is infinitely close to (i.e., their difference is infinitesimal) a unique real number, called its \emph{standard part} and denoted $\operatorname{st}(x)\in\mathbb R$.
See \cref{app:standard-part} for a complete existence-and-uniqueness proof (using the completeness of $\mathbb R$).

\subsubsection{Internal sets and hyperfinite sets}
The ultrapower construction applies not only to numbers but also to sets.
We record a concrete ``sequence-mod-$\mathcal U$'' description that will be used later for Loeb measures and random matching.

\medskip
\noindent\textbf{Internal sets via sequences.}
Fix a base set $S$ (e.g.\ $S=\mathbb N$ or $S=\mathbb R$).
Consider sequences of subsets $(A_n)_{n\in\mathbb N}$ with $A_n\subseteq S$.
Define an equivalence relation on such sequences by
\[
(A_n)\approx (B_n)
\quad\Longleftrightarrow\quad
\{n\in\mathbb N:\ A_n=B_n\}\in\mathcal U.
\]
An \emph{internal subset} of ${}^\ast S$ is, informally, an equivalence class $[(A_n)]$ of such a sequence.
This is the set-analogue of defining hyperreals as equivalence classes of real sequences.

\medskip
\noindent\textbf{Membership is also ``$\mathcal U$-almost sure''.}
Elements of ${}^\ast S$ are themselves equivalence classes of sequences $(s_n)$ with $s_n\in S$.
If $x=[(s_n)]\in{}^\ast S$ and $A=[(A_n)]$ is an internal subset of ${}^\ast S$, then the intended meaning of
\[
x\in A
\]
is:
\[
\{n\in\mathbb N:\ s_n\in A_n\}\in\mathcal U.
\]
Thus internal sets are precisely those for which membership can be checked coordinatewise on representatives, ``for $\mathcal U$-almost all $n$''.

\medskip
\noindent\textbf{Hyperfinite sets.}
The special internal sets that behave like finite sets are called \emph{hyperfinite}.

\begin{definition}[Hyperfinite set]
A set $H$ is \emph{hyperfinite} if:
\begin{enumerate}
  \item $H$ is \emph{internal}, and
  \item there exists some $N\in{}^\ast\mathbb N$ and an \emph{internal bijection}
  \[
  f:\{1,2,\dots,N\}\longrightarrow H.
  \]
\end{enumerate}
Equivalently, $H$ is internal and has an \emph{internal cardinality} $|H|\in{}^\ast\mathbb N$.
\end{definition}

\medskip
\noindent\textbf{The canonical hyperfinite initial segment \(I=\{1,\dots,N\}\).}
Let $N=[(N_n)]\in{}^\ast\mathbb N$ be a (possibly unlimited) hyperinteger.
Define a sequence of standard finite sets
\[
I_n:=\{1,2,\dots,N_n\}\subseteq\mathbb N.
\]
Then the internal set
\[
I:=\{1,2,\dots,N\}\subset{}^\ast\mathbb N
\]
can be represented concretely as the equivalence class $I=[(I_n)]$.
Membership becomes: for $k=[(k_n)]\in{}^\ast\mathbb N$,
\[
k\in I
\quad\Longleftrightarrow\quad
\{n:\ 1\le k_n\le N_n\}\in\mathcal U.
\]
Internally, $I$ is finite-like: by transfer, $|\{1,\dots,N\}|=N$ in the internal sense, so $I$ is hyperfinite with internal cardinality $N$.
If $N$ is unlimited, then externally (in ordinary set theory) $I$ is not a finite set, but it retains enough finite combinatorics to support uniform counting, random matchings, etc., which will later be converted to standard measure-theoretic objects via Loeb measure.

\subsubsection{Transfer principle (informal statement)}
The \emph{transfer principle} says that any first-order statement true of the standard structure (e.g.\ $\mathbb R$, $\mathbb N$) is also true for its nonstandard extension (e.g.\ ${}^\ast\mathbb R$, ${}^\ast\mathbb N$) when all objects are replaced by their star-images. In practice, this lets one use finite combinatorial/probabilistic reasoning on hyperfinite sets as if they were genuinely finite.

\subsection{Loeb measures}
\label{subsec:loeb-measure}

\subsubsection{Internal finitely additive measures}
Let $I$ be hyperfinite and let $\mathcal I_0$ be its \emph{internal power set} (the family of internal subsets of $I$). Define the internal counting probability measure $\lambda_0:\mathcal I_0\to{}^\ast[0,1]$ by
\[
\lambda_0(A)\coloneqq \frac{|A|}{|I|} = \frac{|A|}{N}.
\]
This is internally countably additive (in the internal sense) and behaves like the uniform distribution on a finite set.

\subsubsection{Loeb's theorem (construction of a standard probability space)}
\begin{theorem}[Loeb measure]
From an internal probability space $(I,\mathcal I_0,\lambda_0)$ one can construct a \emph{standard} probability space $(I,\mathcal I,\lambda)$, called its \emph{Loeb space}, such that:
\begin{itemize}
  \item $\mathcal I$ is a $\sigma$-algebra on the underlying set $I$ containing $\mathcal I_0$;
  \item $\lambda$ is a countably additive probability measure on $\mathcal I$; and
  \item for every $A\in\mathcal I_0$, one has $\lambda(A)=\operatorname{st}(\lambda_0(A))$.
\end{itemize}
\end{theorem}

\begin{remark}[Atomlessness]
If $N$ is unlimited, then the Loeb counting measure $\lambda$ is atomless: singleton sets have Loeb measure $0$. Thus Loeb counting spaces provide canonical atomless probability spaces of agents.
\end{remark}

\subsection{Loeb products and the Fubini property (Keisler's theorem)}
\label{subsec:keisler-fubini}

Let $(I,\mathcal I_0,\lambda_0)$ and $(\Omega,\mathcal F_0,P_0)$ be internal probability spaces with hyperfinite underlying sets. Their internal product space is $(I\times\Omega,\mathcal I_0\otimes\mathcal F_0,\lambda_0\otimes P_0)$. Let $(I,\mathcal I,\lambda)$ and $(\Omega,\mathcal F,P)$ be the corresponding Loeb spaces.

\begin{theorem}[Keisler's Fubini theorem for Loeb products, informal]
The Loeb measure of the internal product measure, denoted $\lambda\boxtimes P$, makes
\[
(I\times\Omega,\ \mathcal I\boxtimes\mathcal F,\ \lambda\boxtimes P)
\]
into a \emph{Fubini extension} of the usual product $(I\times\Omega,\mathcal I\otimes\mathcal F,\lambda\otimes P)$. In particular, for every $\lambda\boxtimes P$-integrable function $g$ that is $\mathcal I\boxtimes\mathcal F$-measurable, iterated integrals exist and satisfy the Fubini equalities.
\end{theorem}

\begin{remark}[What is extended?]
The key point is that $\mathcal I\boxtimes\mathcal F$ typically strictly contains $\mathcal I\otimes\mathcal F$. This is \emph{exactly} what allows us to accommodate independent processes and random matchings that cannot live on the usual product $\sigma$-algebra.
\end{remark}

\subsection{Static random full matching on a continuum: hyperfinite construction}
\label{subsec:instantaneous-matching}

We now construct a \emph{static random full matching} with the measure-preservation and independence-in-types properties formalized by Duffie--Sun (2007). This follows the Loeb-space proof scheme in \textbf{Duffie--Sun (2007, Section 4.1)}, proving \textbf{Theorem 2.4}.

\subsubsection{The matching and ``independence-in-types'' definitions}
We state Duffie--Sun's definitions in a notation aligned with this note.

\begin{definition}[Essential pairwise independence (Duffie--Sun 2007, Definition 2.2)]
Let $(I\times\Omega,\mathcal I\boxtimes\mathcal F,\lambda\boxtimes P)$ be a Fubini extension and let $X$ be a complete separable metric space.
An $\mathcal I\boxtimes\mathcal F$-measurable process $f:I\times\Omega\to X$ is \emph{essentially pairwise independent} if for $\lambda$-a.e.\ $i$, the random variables $f_i$ and $f_j$ are independent for $\lambda$-a.e.\ $j$.
\end{definition}

\begin{definition}[Random full matching and independence in types (Duffie--Sun 2007, Definition 2.3)]
Fix a finite type space $S=\{1,\dots,K\}$ and an $\mathcal I$-measurable type function $a:I\to S$, with cross-sectional distribution $p\in\Delta(S)$ given by $p(k)=\lambda(a^{-1}(\{k\}))$.

A \emph{(deterministic) full matching} is a bijection $\phi:I\to I$ such that $\phi(i)\neq i$ and $\phi(\phi(i))=i$ for all $i$ (a fixed-point-free involution).

A \emph{random full matching} is an $\mathcal I\boxtimes\mathcal F$-measurable map $\varphi:I\times\Omega\to I$ such that for each $\omega$, the section $\varphi_\omega(\cdot):i\mapsto \varphi(i,\omega)$ is a full matching.
The induced \emph{matched-type process} (or partner-type process) is $g:I\times\Omega\to S$ defined by
\[
g(i,\omega)\coloneqq a(\varphi(i,\omega)).
\]
The random full matching $\varphi$ is \emph{independent in types} (w.r.t.\ $a$) if $g$ is essentially pairwise independent and, for $\lambda$-a.e.\ $i$, the distribution of $g_i$ is $p$.
\end{definition}

\subsubsection{Duffie--Sun's static existence theorem (Theorem 2.4)}
\begin{theorem}[Existence of universal independent-in-types random full matching (Duffie--Sun 2007, Theorem 2.4, informal)]
There exist:
\begin{itemize}
  \item an atomless probability space $(I,\mathcal I,\lambda)$ of agents,
  \item a sample probability space $(\Omega,\mathcal F,P)$,
  \item a Fubini extension $(I\times\Omega,\mathcal I\boxtimes\mathcal F,\lambda\boxtimes P)$ of the usual product,
  \item and an $\mathcal I\boxtimes\mathcal F$-measurable random full matching $\varphi:I\times\Omega\to I$
\end{itemize}
such that:
\begin{enumerate}
  \item \textbf{(Measure preservation in $i$ and in $\omega$)} For each $\omega$, $\varphi_\omega$ preserves $\lambda$ (equivalently $\lambda(\varphi_\omega^{-1}(A))=\lambda(A)$ for all $A\in\mathcal I$). For each $i$, the random variable $\varphi(i,\cdot)$ has law $\lambda$ (equivalently $P(\varphi(i,\cdot)\in A)=\lambda(A)$ for all $A\in\mathcal I$). Moreover, for any $A_1,A_2\in\mathcal I$, one has $\lambda(A_1\cap \varphi_\omega^{-1}(A_2))=\lambda(A_1)\lambda(A_2)$ for $P$-a.e.\ $\omega$.
  \item \textbf{(Universality in the type function)} For \emph{any} finite type space $S$ and \emph{any} $\mathcal I$-measurable type function $a:I\to S$, the induced partner-type process $g=a\circ\varphi$ is independent in types (in the essential pairwise sense).
\end{enumerate}
\end{theorem}

\subsubsection{Step 1: hyperfinite agents}
Fix an unlimited even hyperinteger $N\in{}^\ast\mathbb N$ and let $I\coloneqq\{1,2,\dots,N\}$ with internal counting measure $\lambda_0$. Let $(I,\mathcal I,\lambda)$ be the Loeb space (atomless).

\subsubsection{Step 2: hyperfinite sample space of perfect matchings}
Let $\Omega$ be the internal set of all \emph{perfect matchings} of $I$\footnote{One way to see that this collection is internal is via the sequence/ultrapower representation: if $I=[(I_n)]$ with finite $I_n$, let $\Omega_n$ be the (finite) set of perfect matchings of $I_n$ and define $\Omega=[(\Omega_n)]$. Equivalently, since $I$ is internal, the set $I^I$ of internal maps $I\to I$ is internal and the condition ``$\omega$ is a fixed-point-free involution'' is an internal (first-order) property, so the set of such $\omega$ is an internal subset of $I^I$.}, meaning fixed-point-free involutions $\omega:I\to I$ satisfying $\omega(\omega(i))=i$ and $\omega(i)\neq i$ for all $i$. (Equivalently, partitions of $I$ into $N/2$ disjoint unordered pairs.)
Endow $\Omega$ with internal counting probability $P_0$ (uniform over matchings), and let $(\Omega,\mathcal F,P)$ be its Loeb space.

\subsubsection{Step 3: the matching map and measurability}
Define $\varphi:I\times\Omega\to I$ by $\varphi(i,\omega)\coloneqq \omega(i)$. This map is internal, hence Loeb measurable with respect to the Loeb product $\sigma$-algebra $\mathcal I\boxtimes\mathcal F$.
Moreover, for each fixed $\omega$, the section $\varphi_\omega(\cdot)=\omega(\cdot)$ is a fixed-point-free involution and (after Loeb-ization) preserves $\lambda$.

\subsubsection{Step 4: measure-preservation and ``no mass on individuals''}
In Duffie--Sun's Theorem 2.4, the key implication is that for each fixed $i$, the law of $\varphi(i,\cdot)$ is exactly $\lambda$. In particular, since $\lambda$ is atomless, for any fixed $j$ one has $P(\varphi(i,\cdot)=j)=\lambda(\{j\})=0$.
In the underlying hyperfinite model one sees this from the exact finite computation
\[
P_0(\varphi(i,\cdot)=j)=\frac{1}{N-1}\quad (j\neq i),
\]
whose standard part is $0$ when $N$ is unlimited.
This formalizes the economic intuition that in a continuum population, the probability of matching with any \emph{particular} counterparty is zero.

\subsubsection{Step 5: independence in types (how it emerges)}
Let $S=\{1,\dots,K\}$ be a finite type set, and let $a:I\to S$ be any (Loeb) measurable type function with type distribution $\rho\in\Delta(S)$ given by $\rho(k)=\lambda(\{i:a(i)=k\})$.
Define the induced \emph{partner-type} process $g:I\times\Omega\to S$ by
\[
g(i,\omega)\coloneqq a(\varphi(i,\omega)).
\]
In the terminology of \textbf{Duffie--Sun (2007)}, $g$ is the matched-type process induced by a random full matching (Definition 2.3), and ``independent in types'' means $g$ is essentially pairwise independent (Definition 2.2) and has the correct marginal distribution.

The main existence result, \textbf{Duffie--Sun (2007), Theorem 2.4}, shows that one can choose $\varphi$ so that for \emph{any} given measurable type assignment $a$, the induced $g=a\circ\varphi$ is independent in types.
At a high level, the proof uses explicit finite-$N$ calculations for uniform random perfect matchings to show that the relevant dependence terms are infinitesimal for a hyperfinite $N$, and then passes to Loeb measures to obtain the essential pairwise independence conclusion \emph{exactly}.

To situate this precisely, the construction is carried out on the \emph{Loeb product (joint) space}
\[
(I\times\Omega,\ \mathcal I\boxtimes\mathcal F,\ \lambda\boxtimes P),
\]
obtained by Loeb-izing the internal product $(I\times\Omega,\mathcal I_0\otimes\mathcal F_0,\lambda_0\otimes P_0)$; here $I$ is a hyperfinite agent set, $\Omega$ is the hyperfinite set of perfect matchings of $I$, and $\varphi(i,\omega)=\omega(i)$ and $g(i,\omega)=a(\varphi(i,\omega))$ are internal maps (hence $\mathcal I\boxtimes\mathcal F$-measurable after Loeb-ization). Keisler's Fubini theorem implies that $(I\times\Omega,\mathcal I\boxtimes\mathcal F,\lambda\boxtimes P)$ is a \emph{Fubini extension} of the usual product $(I\times\Omega,\mathcal I\otimes\mathcal F,\lambda\otimes P)$, so iterated integrals over agents and randomness can be interchanged for $\lambda\boxtimes P$-integrable functions.

The remaining substantive point in \textbf{Duffie--Sun (2007), Theorem 2.4} is the \emph{independence-in-types} property for $g$. The proof proceeds by (i) analyzing a genuinely finite $N$-agent uniform random perfect matching and obtaining explicit bounds showing that cross-agent dependence of partner-type events is of order $1/N$; (ii) transferring these bounds to a hyperfinite $N$, making the dependence \emph{infinitesimal}; and (iii) passing to the Loeb product measure on $I\times I$ (equivalently, using $\lambda\times\lambda$-almost-every pair $(i,j)$) to conclude that the limiting statement holds \emph{exactly} in the essential sense: for $\lambda$-a.e.\ $i$, the random variables $g_i$ and $g_j$ are independent for $\lambda$-a.e.\ $j$.

\subsection{From Loeb products to Fubini extensions suitable for independent processes}
\label{subsec:from-loeb-to-fubini}
The Loeb product construction above yields a probability space $(I\times\Omega,\mathcal I\boxtimes\mathcal F,\lambda\boxtimes P)$ that:
\begin{itemize}
  \item extends the usual product $(I\times\Omega,\mathcal I\otimes\mathcal F,\lambda\otimes P)$;
  \item satisfies the Fubini property by Keisler's theorem; and
  \item supports a jointly measurable matching map $\varphi$.
\end{itemize}
This is precisely a \emph{Fubini extension} in the sense of \cref{subsec:fubini-extension-def}.

\subsection{Random partial matching (static search): statement}
\label{subsec:partial-matching}
Duffie--Sun (2007) also treat \emph{partial} matchings (random search): some agents draw ``no match''.
Formally, one extends the range to $I\cup\{J\}$, where $J$ denotes no match, and requires that the restriction of the matching on $I\setminus \varphi_\omega^{-1}(\{J\})$ is a full matching (paired without self-matching).
The corresponding partner-type process then takes values in $S\cup\{J\}$.

\begin{theorem}[Existence of independent-in-types random partial matching (Duffie--Sun 2007, Theorem 2.6, informal)]
Fix an atomless agent space $(I,\mathcal I,\lambda)$.
For any given measurable type function $a:I\to S$ and any prescribed no-match probabilities $q\in[0,1]^S$, there exist a sample space and a Fubini extension on which one can define an independent-in-types random partial matching with those no-match probabilities.
\end{theorem}

\subsection{Putting it together for static matching}
The Loeb-space construction gives a concrete recipe for building the probability space used for static matching:
\begin{enumerate}
  \item Choose an unlimited hyperfinite even $N$ and set $I=\{1,\dots,N\}$; take its Loeb space $(I,\mathcal I,\lambda)$ as the agent space.
  \item Let $\Omega$ be the hyperfinite set of perfect matchings of $I$, with uniform internal counting measure, and take its Loeb space $(\Omega,\mathcal F,P)$ as the sample space.
  \item Form the Loeb product space $(I\times\Omega,\mathcal I\boxtimes\mathcal F,\lambda\boxtimes P)$, which is a Fubini extension.
  \item Define the matching map $\varphi(i,\omega)=\omega(i)$ (jointly measurable on the extension) and, for any type function $a$, define partner-type process $g(i,\omega)=a(\varphi(i,\omega))$.
  \item Use the independence-in-types property of $g$ (Duffie--Sun, 2007) and (optionally) Sun's exact law of large numbers on a Fubini extension (Sun, 2006) to deduce deterministic aggregation results (e.g.\ deterministic cross-sectional partner-type frequencies).
\end{enumerate}

\subsection{Bibliographic notes (minimal)}
The definition and systematic use of Fubini extensions and exact law of large numbers are developed in:
\begin{quote}
Y.\ Sun, \emph{The exact law of large numbers via Fubini extension and characterization of insurable risks}, Journal of Economic Theory 126 (2006), 31--69.
\end{quote}
The Loeb-space (nonstandard) existence construction of independent random matching in a continuum population is developed in:
\begin{quote}
D.\ Duffie and Y.\ Sun, \emph{Existence of independent random matching}, Annals of Applied Probability 17 (2007), 386--419.
\end{quote}

\appendix

\section{Existence and uniqueness of the standard part}
\label{app:standard-part}

In the main text we used the fact that every \emph{finite} hyperreal is infinitely close to a unique real number.
For completeness, we record a standard proof based on the least-upper-bound property of $\mathbb R$.

\begin{theorem}[Standard part of a finite hyperreal]
Let $x\in{}^\ast\mathbb R$ be finite, i.e.\ $|x|<n$ for some $n\in\mathbb N$.
Then there exists a unique $r\in\mathbb R$ such that $x-{}^\ast r$ is infinitesimal.
We denote this real number by $\operatorname{st}(x)=r$.
\end{theorem}

\begin{proof}
Define
\[
A:=\{q\in\mathbb Q:\ {}^\ast q < x\}.
\]
We first check that $A$ is nonempty and bounded above in $\mathbb R$.
Since $|x|<n$ for some $n\in\mathbb N$, we have ${}^\ast(-n)<x$, hence $-n\in A$, so $A\neq\emptyset$.
Also ${}^\ast q < x$ implies $q<n$, so $A\subset (-\infty,n)$, hence $A$ is bounded above.
By completeness of $\mathbb R$, the supremum
\[
r:=\sup A \in \mathbb R
\]
exists.

\medskip
\noindent\emph{Claim: $x\approx {}^\ast r$, i.e.\ $|x-{}^\ast r|<1/m$ for every $m\in\mathbb N$.}
Fix $m\in\mathbb N$.

\smallskip
\noindent\emph{(i) Show $x<{}^\ast(r+1/m)$.}
If instead $x\ge {}^\ast(r+1/m)$, choose a rational $q$ with $r<q<r+1/m$ (density of $\mathbb Q$).
Then ${}^\ast q \le x$, so $q\in A$, contradicting $q>r=\sup A$.
Hence $x<{}^\ast(r+1/m)$, equivalently $x-{}^\ast r<1/m$.

\smallskip
\noindent\emph{(ii) Show $x>{}^\ast(r-1/m)$.}
If instead $x\le {}^\ast(r-1/m)$, then for every rational $q<r-1/m$ we have ${}^\ast q < x$, so $q\in A$.
This would force $\sup A \le r-1/m$, contradicting $\sup A=r$.
Hence $x>{}^\ast(r-1/m)$, equivalently ${}^\ast r-x<1/m$.

\smallskip
Combining (i) and (ii) gives $|x-{}^\ast r|<1/m$.
Since $m$ was arbitrary, $x-{}^\ast r$ is infinitesimal, proving existence.

\medskip
\noindent\emph{Uniqueness.}
If $x\approx {}^\ast r$ and $x\approx {}^\ast s$ for $r,s\in\mathbb R$, then ${}^\ast(r-s)=({}^\ast r- x)+(x-{}^\ast s)$ is infinitesimal.
But $r-s$ is a real number, and the only real infinitesimal is $0$, so $r=s$.
\end{proof}

\end{document}


